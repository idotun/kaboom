SELECT
    CASE WHEN transaction_id IS NOT NULL THEN 1 ELSE 0 END AS transaction_flag,
    AVG(visit_duration) AS avg_visit_duration
  FROM
    `kaboom-408215.kaboom.user_engagements`
  WHERE userid IS NOT NULL
  GROUP BY 1 

SELECT CASE WHEN transaction_id IS NOT NULL THEN 1 ELSE 0 END AS transaction_flag, funnel_level,
      COUNT(sessionid) AS visits
FROM kaboom-408215.kaboom.user_engagements
WHERE userid IS NOT NULL AND funnel_level IN ('menu', 'checkout')
GROUP BY 1,2
